<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê²½ë‚¨ ê±´ì¶• ì†Œì‹ â€” ë¶€ì‚°Â·ê²½ë‚¨ ê±´ì¶• ì •ë³´ì§€</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;700;900&family=Noto+Sans+KR:wght@300;400;500&family=Playfair+Display:ital,wght@0,700;0,900;1,700&display=swap" rel="stylesheet">
<style>
:root {
  --ink: #1a1208;
  --ink2: #2d2416;
  --paper: #f5f0e8;
  --paper2: #ede8da;
  --paper3: #e4dece;
  --rule: #2d2416;
  --rule-light: #c8bfa8;
  --accent: #8b1a1a;
  --accent2: #b8390e;
  --muted: #6b5f4a;
  --col-gap: 1.5rem;
}
* { margin:0; padding:0; box-sizing:border-box; }

body {
  background: var(--paper);
  color: var(--ink);
  font-family: 'Noto Serif KR', serif;
  font-size: 14px;
  line-height: 1.7;
}

/* â”€â”€ MASTHEAD â”€â”€ */
.masthead {
  border-top: 4px solid var(--rule);
  border-bottom: 1px solid var(--rule);
  padding: 0.6rem 2rem 0;
  background: var(--paper);
}
.masthead-top {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  border-bottom: 1px solid var(--rule-light);
  padding-bottom: 0.35rem;
  margin-bottom: 0.4rem;
  flex-wrap: wrap;
  gap: 0.5rem;
}
.masthead-meta { font-family: 'Noto Sans KR', sans-serif; font-size: 0.65rem; color: var(--muted); letter-spacing: 0.05em; }
.masthead-tagline { font-family: 'Noto Serif KR', serif; font-size: 0.65rem; font-style: italic; color: var(--muted); }

.masthead-title {
  text-align: center;
  padding: 0.5rem 0 0.6rem;
}
.paper-name {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2.2rem, 5vw, 3.8rem);
  font-weight: 900;
  letter-spacing: 0.1em;
  color: var(--ink);
  line-height: 1;
  display: block;
}
.paper-sub {
  font-family: 'Noto Serif KR', serif;
  font-size: 0.72rem;
  letter-spacing: 0.35em;
  color: var(--ink2);
  margin-top: 0.3rem;
  display: block;
}

.masthead-bottom {
  border-top: 3px double var(--rule);
  border-bottom: 1px solid var(--rule);
  margin-top: 0.4rem;
  padding: 0.3rem 0;
  display: flex;
  gap: 0;
  overflow-x: auto;
}
.nav-item {
  padding: 0 1rem;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.72rem;
  font-weight: 500;
  letter-spacing: 0.05em;
  cursor: pointer;
  white-space: nowrap;
  border-right: 1px solid var(--rule-light);
  transition: color 0.15s;
  color: var(--ink2);
}
.nav-item:first-child { padding-left: 0; }
.nav-item:hover, .nav-item.active { color: var(--accent); font-weight: 700; }

/* â”€â”€ TICKER â”€â”€ */
.ticker-wrap {
  background: var(--ink);
  color: var(--paper);
  padding: 0.35rem 2rem;
  display: flex;
  align-items: center;
  gap: 1rem;
  overflow: hidden;
}
.ticker-label {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.62rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  color: var(--paper2);
  background: var(--accent);
  padding: 0.1rem 0.5rem;
  white-space: nowrap;
  flex-shrink: 0;
}
.ticker-text {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.7rem;
  white-space: nowrap;
  animation: tickerMove 50s linear infinite;
  color: #e8e0cc;
}
@keyframes tickerMove { from{transform:translateX(60vw)} to{transform:translateX(-300%)} }

/* â”€â”€ CONTROLS â”€â”€ */
.controls-bar {
  border-bottom: 1px solid var(--rule-light);
  padding: 0.6rem 2rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
  background: var(--paper2);
}
.ctrl-label { font-family: 'Noto Sans KR', sans-serif; font-size: 0.65rem; color: var(--muted); font-weight: 500; }
.chip {
  padding: 0.2rem 0.65rem;
  border: 1px solid var(--rule-light);
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.68rem;
  cursor: pointer;
  background: transparent;
  color: var(--ink2);
  transition: all 0.12s;
}
.chip:hover { border-color: var(--ink); }
.chip.on { background: var(--ink); color: var(--paper); border-color: var(--ink); }
.fetch-btn {
  margin-left: auto;
  padding: 0.35rem 1.4rem;
  background: var(--accent);
  color: #fff;
  border: none;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.72rem;
  font-weight: 700;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: background 0.15s;
}
.fetch-btn:hover { background: var(--accent2); }
.fetch-btn:disabled { background: var(--rule-light); color: var(--muted); cursor: not-allowed; }

/* â”€â”€ MAIN â”€â”€ */
.page { max-width: 1280px; margin: 0 auto; padding: 1.5rem 2rem 3rem; }

.front-page {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0 var(--col-gap);
}

/* â”€â”€ HERO â”€â”€ */
.story-hero {
  grid-column: 1 / 4;
  border-bottom: 1px solid var(--rule-light);
  padding-bottom: 1.25rem;
  cursor: pointer;
  transition: opacity 0.12s;
}
.story-hero:hover { opacity: 0.85; }

.kicker-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}
.cat-badge {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.1em;
  padding: 0.12rem 0.45rem;
  display: inline-block;
}
.cat-ê³µëª¨ { background: #dde8f0; color: #1a4a6b; }
.cat-ë‹¹ì„  { background: #d4eada; color: #1a4a2e; }
.cat-ì°©ê³µ { background: #f7e9c8; color: #5a3800; }
.cat-ì¤€ê³µ { background: #fddfd9; color: #6b1a0e; }
.cat-ê°œë°œ { background: #e8daf5; color: #3d1a6b; }
.cat-ê¸°íƒ€ { background: var(--paper3); color: var(--muted); }

.area-tag {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.6rem;
  color: var(--muted);
  border: 1px solid var(--rule-light);
  padding: 0.12rem 0.45rem;
}

.story-hero h1 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.4rem, 2.2vw, 2rem);
  font-weight: 900;
  line-height: 1.2;
  margin-bottom: 0.5rem;
  letter-spacing: -0.01em;
}
.story-hero .deck {
  font-family: 'Noto Serif KR', serif;
  font-size: 0.88rem;
  color: var(--ink2);
  line-height: 1.65;
  margin-bottom: 0.75rem;
  border-left: 3px solid var(--accent);
  padding-left: 0.75rem;
}
.story-hero .body-text {
  font-family: 'Noto Serif KR', serif;
  font-size: 0.8rem;
  line-height: 1.9;
  color: var(--ink2);
  column-count: 2;
  column-gap: 1.2rem;
  column-rule: 1px solid var(--rule-light);
}
.byline {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.6rem;
  color: var(--muted);
  margin-top: 0.6rem;
  letter-spacing: 0.04em;
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
  border-top: 1px solid var(--rule-light);
  padding-top: 0.4rem;
}
.byline .src { color: var(--accent); font-weight: 600; }

/* â”€â”€ SIDEBAR â”€â”€ */
.sidebar-col {
  grid-column: 4 / 6;
  border-left: 2px solid var(--rule);
  padding-left: var(--col-gap);
}

.section-head {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.6rem;
  font-weight: 700;
  letter-spacing: 0.2em;
  color: #fff;
  background: var(--ink);
  padding: 0.22rem 0.55rem;
  display: inline-block;
  margin-bottom: 0.75rem;
}
.section-head.red { background: var(--accent); }

.sidebar-section { margin-bottom: 1.25rem; padding-bottom: 1.25rem; border-bottom: 1px solid var(--rule-light); }
.sidebar-section:last-child { border-bottom: none; }

.story-sm {
  padding: 0.65rem 0;
  border-bottom: 1px dotted var(--rule-light);
  cursor: pointer;
  transition: opacity 0.12s;
  position: relative;
}
.story-sm:last-child { border-bottom: none; }
.story-sm:hover { opacity: 0.7; }
.story-sm:hover .delete-btn { opacity: 1; }
.delete-btn {
  position: absolute;
  top: 0.65rem; right: 0;
  opacity: 0;
  transition: opacity 0.15s;
  background: transparent;
  border: 1px solid var(--rule-light);
  color: var(--muted);
  font-size: 0.58rem;
  padding: 0.15rem 0.4rem;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
  line-height: 1;
  z-index: 2;
}
.delete-btn:hover { background: var(--accent); color: #fff; border-color: var(--accent); }
.story-sm h3 {
  font-family: 'Noto Serif KR', serif;
  font-size: 0.82rem;
  font-weight: 700;
  line-height: 1.4;
  margin: 0.2rem 0 0.2rem;
}
.story-sm p {
  font-family: 'Noto Serif KR', serif;
  font-size: 0.72rem;
  color: var(--muted);
  line-height: 1.5;
  display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
}
.story-sm .smeta {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.58rem;
  color: var(--rule-light);
  margin-top: 0.2rem;
}
.story-sm .smeta .ssrc { color: var(--accent); }

/* â”€â”€ STATS â”€â”€ */
.stats-box { background: var(--paper3); border: 1px solid var(--rule-light); padding: 0.75rem; }
.stats-title { font-family: 'Noto Sans KR', sans-serif; font-size: 0.58rem; font-weight: 700; letter-spacing: 0.12em; color: var(--muted); margin-bottom: 0.5rem; }
.stats-row { display: flex; justify-content: space-between; padding: 0.22rem 0; border-bottom: 1px dotted var(--rule-light); font-size: 0.7rem; }
.stats-row:last-child { border-bottom: none; font-weight: 700; }
.stats-num { font-family: 'Playfair Display', serif; font-weight: 700; color: var(--accent); font-size: 0.85rem; }

/* â”€â”€ LOWER GRID â”€â”€ */
.lower-grid {
  margin-top: 1rem;
  border-top: 3px double var(--rule);
  padding-top: 1rem;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0 var(--col-gap);
}
.lower-col { border-right: 1px solid var(--rule-light); padding-right: var(--col-gap); }
.lower-col:last-child { border-right: none; padding-right: 0; }
.col-title {
  font-family: 'Playfair Display', serif;
  font-size: 0.9rem;
  font-weight: 700;
  border-bottom: 2px solid var(--rule);
  padding-bottom: 0.3rem;
  margin-bottom: 0.75rem;
  color: var(--ink);
}

/* â”€â”€ LOADING / ERROR â”€â”€ */
.loading-full {
  grid-column: 1 / -1;
  text-align: center;
  padding: 5rem 2rem;
}
.loading-spinner {
  display: inline-block;
  width: 30px; height: 30px;
  border: 2px solid var(--rule-light);
  border-top-color: var(--ink);
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-msg { font-family: 'Noto Serif KR', serif; font-size: 0.85rem; color: var(--muted); margin-top: 1rem; font-style: italic; }

.error-box {
  grid-column: 1/-1;
  border: 1px solid var(--accent);
  padding: 1.5rem;
  text-align: center;
  background: #fdf5f5;
}
.error-box h3 { color: var(--accent); margin-bottom: 0.4rem; font-family: 'Noto Serif KR', serif; }
.error-box p { font-size: 0.78rem; color: var(--muted); }

/* â”€â”€ MODAL â”€â”€ */
.backdrop {
  display: none; position: fixed; inset: 0;
  background: rgba(26,18,8,0.72);
  z-index: 200;
  overflow-y: auto;
  padding: 3rem 1rem;
}
.backdrop.open { display: block; }
.modal {
  max-width: 740px; margin: 0 auto;
  background: var(--paper);
  border: 1px solid var(--rule);
  padding: 2.5rem;
  position: relative;
  animation: slideIn 0.2s ease;
}
@keyframes slideIn { from{opacity:0;transform:translateY(10px)} }
.modal-close-btn {
  position: absolute; top: 1rem; right: 1rem;
  background: none; border: 1px solid var(--rule-light);
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.65rem; color: var(--muted);
  padding: 0.25rem 0.6rem; cursor: pointer;
}
.modal-close-btn:hover { background: var(--ink); color: var(--paper); border-color: var(--ink); }
.modal-kicker {
  font-family: 'Noto Sans KR', sans-serif; font-size: 0.62rem;
  font-weight: 700; letter-spacing: 0.15em;
  border-bottom: 2px solid var(--accent); display: inline-flex;
  align-items: center; gap: 0.5rem;
  padding-bottom: 0.1rem; margin-bottom: 0.75rem;
}
.modal-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 900; line-height: 1.3; margin-bottom: 0.5rem; }
.modal-deck { font-family: 'Noto Serif KR', serif; font-size: 0.88rem; color: var(--ink2); border-left: 3px solid var(--accent); padding: 0.3rem 0.75rem; margin-bottom: 1rem; line-height: 1.65; }
.modal-byline { font-family: 'Noto Sans KR', sans-serif; font-size: 0.62rem; color: var(--muted); padding-bottom: 0.75rem; border-bottom: 1px solid var(--rule-light); margin-bottom: 1rem; display: flex; gap: 1rem; flex-wrap: wrap; }
.modal-byline .msrc { color: var(--accent); font-weight: 600; }
.modal-body { font-family: 'Noto Serif KR', serif; font-size: 0.85rem; line-height: 1.95; color: var(--ink2); white-space: pre-wrap; }
.modal-keywords { margin-top: 1.25rem; padding-top: 0.75rem; border-top: 1px solid var(--rule-light); font-family: 'Noto Sans KR', sans-serif; font-size: 0.65rem; color: var(--muted); display: flex; gap: 0.5rem; flex-wrap: wrap; }
.kw-pill { background: var(--paper3); border: 1px solid var(--rule-light); padding: 0.15rem 0.5rem; }

.modal-links {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 2px solid var(--rule);
  display: flex;
  gap: 0.6rem;
  flex-wrap: wrap;
}
.search-link {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.45rem 1rem;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.72rem;
  font-weight: 500;
  text-decoration: none;
  border: 1px solid var(--rule-light);
  color: var(--ink2);
  background: var(--paper2);
  transition: all 0.15s;
  cursor: pointer;
}
.search-link:hover { background: var(--ink); color: var(--paper); border-color: var(--ink); }
.search-link.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
.search-link.primary:hover { background: var(--accent2); border-color: var(--accent2); }
.search-link-note {
  width: 100%;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.6rem;
  color: var(--rule-light);
  margin-top: 0.25rem;
}

/* â”€â”€ FACT CHECK BAR â”€â”€ */
.factcheck-bar {
  border-bottom: 1px solid var(--rule-light);
  padding: 0.6rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  flex-wrap: wrap;
  background: #fdf8f0;
  border-left: 4px solid #b8860b;
}
.factcheck-left { display: flex; align-items: center; gap: 0.6rem; flex-wrap: wrap; }
.factcheck-icon { font-size: 1rem; }
.factcheck-title {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.75rem;
  font-weight: 700;
  color: #5a3e00;
  letter-spacing: 0.04em;
}
.factcheck-desc {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.65rem;
  color: var(--muted);
}
.factcheck-right { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; }
.fc-stat {
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.65rem;
  color: var(--muted);
  padding: 0.2rem 0.6rem;
  background: var(--paper3);
  border: 1px solid var(--rule-light);
}
.fc-stat strong { color: var(--ink); margin-left: 0.2rem; }
.fc-stat.danger strong { color: var(--accent); }
.factcheck-btn {
  padding: 0.35rem 1rem;
  background: #5a3e00;
  color: #fff;
  border: none;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.06em;
  cursor: pointer;
  transition: background 0.15s;
  white-space: nowrap;
}
.factcheck-btn:hover { background: #7a5500; }
.factcheck-btn:disabled { background: var(--rule-light); color: var(--muted); cursor: not-allowed; }

/* ê²€ì¦ ìƒíƒœ ë±ƒì§€ (ì¹´ë“œì— í‘œì‹œ) */
.verified-badge {
  display: inline-block;
  font-size: 0.55rem;
  padding: 0.1rem 0.35rem;
  margin-left: 0.3rem;
  font-family: 'Noto Sans KR', sans-serif;
  vertical-align: middle;
}
.badge-real { background: #d4eada; color: #1a4a2e; border: 1px solid #a0c8a8; }
.badge-fake { background: #fddfd9; color: #6b1a0e; border: 1px solid #e0a090; }
.badge-uncertain { background: #f7e9c8; color: #5a3800; border: 1px solid #d4b86a; }

/* â”€â”€ FOOTER â”€â”€ */
footer {
  border-top: 3px double var(--rule);
  padding: 1rem 2rem;
  text-align: center;
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 0.62rem;
  color: var(--muted);
  letter-spacing: 0.06em;
  background: var(--paper2);
  line-height: 1.8;
}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media (max-width: 960px) {
  .front-page { grid-template-columns: 1fr 1fr; }
  .story-hero { grid-column: 1/3; }
  .story-hero .body-text { column-count: 1; }
  .sidebar-col { grid-column: 1/3; border-left: none; border-top: 2px solid var(--rule); padding: 1rem 0 0; }
  .lower-grid { grid-template-columns: 1fr 1fr; }
  .lower-col:nth-child(even) { border-right: none; padding-right: 0; }
  .lower-col:nth-child(odd) { padding-left: 0; }
}
@media (max-width: 600px) {
  .front-page, .lower-grid { grid-template-columns: 1fr; }
  .story-hero, .sidebar-col { grid-column: 1; }
  .lower-col { border-right: none; border-bottom: 1px solid var(--rule-light); padding: 0 0 1rem; margin-bottom: 1rem; }
  .masthead, .controls-bar, .ticker-wrap, .page { padding-left: 1rem; padding-right: 1rem; }
}
</style>
</head>
<body>

<!-- MASTHEAD -->
<header class="masthead">
  <div class="masthead-top">
    <span class="masthead-meta" id="todayDate">â€”</span>
    <span class="masthead-tagline">ë¶€ì‚°Â·ê²½ë‚¨Â·ìš¸ì‚° ê±´ì¶•Â·ë„ì‹œ ì •ë³´ ì „ë¬¸</span>
    <span class="masthead-meta" id="updateTime">ë§ˆì§€ë§‰ ìˆ˜ì§‘: â€”</span>
  </div>
  <div class="masthead-title">
    <span class="paper-name">ê²½ë‚¨ ê±´ì¶• ì†Œì‹</span>
    <span class="paper-sub">BUSAN Â· GYEONGNAM ARCHITECTURE DAILY</span>
  </div>
  <nav class="masthead-bottom">
    <div class="nav-item active" data-section="all">ì „ì²´</div>
    <div class="nav-item" data-section="ê³µëª¨">í˜„ìƒì„¤ê³„Â·ê³µëª¨</div>
    <div class="nav-item" data-section="ë‹¹ì„ ">ë‹¹ì„ Â·ê²°ê³¼</div>
    <div class="nav-item" data-section="ì°©ê³µ">ì°©ê³µÂ·ì¸í—ˆê°€</div>
    <div class="nav-item" data-section="ì¤€ê³µ">ì¤€ê³µÂ·ì™„ê³µ</div>
    <div class="nav-item" data-section="ê°œë°œ">ë„ì‹œê°œë°œ</div>
  </nav>
</header>

<!-- TICKER -->
<div class="ticker-wrap">
  <span class="ticker-label">ì†ë³´</span>
  <span class="ticker-text" id="tickerText">â–¶ ë‰´ìŠ¤ ìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë¶€ì‚°Â·ê²½ë‚¨ ê±´ì¶• ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”  Â·  í˜„ìƒì„¤ê³„ê³µëª¨ Â· ì°©ê³µ Â· ì¤€ê³µ Â· ë„ì‹œê°œë°œ ì´ìŠˆ ìë™ ìˆ˜ì§‘  Â·  BUSAN GYEONGNAM ARCHITECTURE DAILY</span>
</div>

<!-- CONTROLS -->
<div class="controls-bar">
  <span class="ctrl-label">ì§€ì—­</span>
  <div class="chip on" data-region="ì „ì²´">ì „ì²´</div>
  <div class="chip" data-region="ë¶€ì‚°">ë¶€ì‚°</div>
  <div class="chip" data-region="ê²½ë‚¨">ê²½ë‚¨</div>
  <div class="chip" data-region="ìš¸ì‚°">ìš¸ì‚°</div>
  <span class="ctrl-label" style="margin-left:0.5rem;">ì •ë ¬</span>
  <div class="chip on" data-sort="importance">ì¤‘ìš”ë„ìˆœ</div>
  <div class="chip" data-sort="date">ìµœì‹ ìˆœ</div>
  <span id="totalBadge" style="font-family:'Noto Sans KR',sans-serif;font-size:0.65rem;color:var(--muted);margin-left:0.25rem;"></span>
  <button class="fetch-btn" id="fetchBtn" onclick="loadNews()">â–¶ ë‰´ìŠ¤ ìˆ˜ì§‘</button>
</div>

<!-- FACT CHECK BAR -->
<div class="factcheck-bar">
  <div class="factcheck-left">
    <span class="factcheck-icon">ğŸ”</span>
    <span class="factcheck-title">ê°€ì§œë‰´ìŠ¤ ì „ì²´ ê²€í† </span>
    <span class="factcheck-desc" id="fcDesc">ëˆ„ì  ê¸°ì‚¬ ì¤‘ ë¯¸ê²€í†  ê¸°ì‚¬ë¥¼ AIê°€ ìë™ ê²€ì¦í•©ë‹ˆë‹¤</span>
  </div>
  <div class="factcheck-right">
    <div class="fc-stat" id="fcStatVerified">ê²€ì¦ì™„ë£Œ <strong>0</strong></div>
    <div class="fc-stat" id="fcStatPending">ë¯¸ê²€í†  <strong>0</strong></div>
    <div class="fc-stat danger" id="fcStatRemoved">ì‚­ì œë¨ <strong>0</strong></div>
    <button class="factcheck-btn" id="fcBtn" onclick="runFactCheck()">ê²€í†  ì‹œì‘</button>
  </div>
</div>

<!-- MAIN -->
<main class="page">
  <div class="front-page" id="frontPage">
    <div class="loading-full">
      <div style="font-family:'Noto Serif KR',serif;font-size:2.5rem;font-weight:900;color:var(--rule-light);letter-spacing:0.05em;margin-bottom:1rem;">ê²½ë‚¨ ê±´ì¶• ì†Œì‹</div>
      <div class="loading-msg" style="font-style:normal;">ìƒë‹¨ <strong style="color:var(--accent);">â–¶ ë‰´ìŠ¤ ìˆ˜ì§‘</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ê±´ì¶• ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</div>
      <div style="margin-top:0.75rem;font-family:'Noto Sans KR',sans-serif;font-size:0.68rem;color:var(--rule-light);">í˜„ìƒì„¤ê³„ê³µëª¨ Â· ë‹¹ì„  Â· ì°©ê³µÂ·ì¸í—ˆê°€ Â· ì¤€ê³µÂ·ì™„ê³µ Â· ë„ì‹œê°œë°œ ì´ìŠˆ</div>
    </div>
  </div>
  <div class="lower-grid" id="lowerGrid" style="display:none;"></div>
</main>

<footer>
  ê²½ë‚¨ ê±´ì¶• ì†Œì‹ Â· BUSAN GYEONGNAM ARCHITECTURE DAILY<br>
  AI ê¸°ë°˜ ìë™ ìˆ˜ì§‘ â€” ë¶€ì‚°ì¼ë³´ Â· êµ­ì œì‹ ë¬¸ Â· ê²½ë‚¨ì‹ ë¬¸ Â· ë‚˜ë¼ì¥í„° Â· í•œêµ­ê±´ì¶•ê°€í˜‘íšŒ ì™¸ ë‹¤ìˆ˜ ì†ŒìŠ¤<br>
  ë³¸ ì„œë¹„ìŠ¤ëŠ” ì •ë³´ ì œê³µ ëª©ì ì´ë©° ì›ë¬¸ í™•ì¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤
</footer>

<!-- MODAL -->
<div class="backdrop" id="backdrop" onclick="closeModal(event)">
  <div class="modal" id="modalBox">
    <button class="modal-close-btn" onclick="document.getElementById('backdrop').classList.remove('open')">âœ• ë‹«ê¸°</button>
    <button class="modal-close-btn" style="right:5rem;background:var(--accent);color:#fff;border-color:var(--accent);" id="mDeleteBtn">ğŸ—‘ ì‚­ì œ</button>
    <div class="modal-kicker" id="mKicker"></div>
    <div class="modal-title" id="mTitle"></div>
    <div class="modal-deck" id="mDeck"></div>
    <div class="modal-byline" id="mByline"></div>
    <div class="modal-body" id="mBody"></div>
    <div class="modal-keywords" id="mKeywords"></div>
    <div class="modal-links" id="mLinks"></div>
  </div>
</div>

<script>
// â”€â”€ STATE â”€â”€
let articles = [];        // í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ì „ì²´ ëˆ„ì  ê¸°ì‚¬
let activeSection = 'all';
let activeRegion = 'ì „ì²´';
let activeSort = 'date';  // ê¸°ë³¸: ìµœì‹ ìˆœ (ëˆ„ì ì´ë‹ˆê¹Œ)

const STORAGE_KEY = 'arch-busan-articles';

// â”€â”€ DATE â”€â”€
const now = new Date();
document.getElementById('todayDate').textContent =
  now.toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric',weekday:'long'});

// â”€â”€ ì €ì¥ëœ ê¸°ì‚¬ ë¶ˆëŸ¬ì˜¤ê¸° (í˜ì´ì§€ ë¡œë“œì‹œ) â”€â”€
async function loadSaved() {
  try {
    const result = await window.storage.get(STORAGE_KEY);
    if (result && result.value) {
      articles = JSON.parse(result.value);
      const lastTime = articles[0]?._collectedAt;
      if (lastTime) document.getElementById('updateTime').textContent = 'ë§ˆì§€ë§‰ ìˆ˜ì§‘: ' + lastTime;
      updateTicker();
      render();
      updateCountBadge();
    }
  } catch(e) {
    // ì €ì¥ëœ ë°ì´í„° ì—†ìŒ â€” ì´ˆê¸° ìƒíƒœ ìœ ì§€
  }
}

// â”€â”€ ê¸°ì‚¬ ëˆ„ì  ì €ì¥ â”€â”€
async function saveArticles() {
  try {
    await window.storage.set(STORAGE_KEY, JSON.stringify(articles));
  } catch(e) {
    console.warn('ì €ì¥ ì‹¤íŒ¨:', e);
  }
}

// â”€â”€ ì „ì²´ ì´ˆê¸°í™” â”€â”€
async function clearAll() {
  if (!confirm(`ì €ì¥ëœ ê¸°ì‚¬ ${articles.length}ê°œë¥¼ ëª¨ë‘ ì‚­ì œí• ê¹Œìš”?`)) return;
  try {
    await window.storage.delete(STORAGE_KEY);
  } catch(e) {}
  articles = [];
  updateCountBadge();
  updateTicker();
  document.getElementById('frontPage').innerHTML = `<div class="loading-full">
    <div style="font-family:'Playfair Display',serif;font-size:2.5rem;font-weight:900;color:var(--rule-light);letter-spacing:0.1em;margin-bottom:1rem;">å»ºç¯‰æ—¥å ±</div>
    <div class="loading-msg" style="font-style:normal;">ê¸°ì‚¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.<br>â–¶ ë‰´ìŠ¤ ìˆ˜ì§‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ì„¸ìš”.</div>
  </div>`;
  document.getElementById('lowerGrid').style.display = 'none';
  document.getElementById('updateTime').textContent = 'ë§ˆì§€ë§‰ ìˆ˜ì§‘: â€”';
}

// â”€â”€ ëˆ„ì  ê¸°ì‚¬ ìˆ˜ ë±ƒì§€ â”€â”€
function updateCountBadge() {
  const el = document.getElementById('totalBadge');
  if (el) el.textContent = `ì´ ${articles.length}ê±´ ëˆ„ì `;
}

// â”€â”€ NAV â”€â”€
document.querySelectorAll('.nav-item[data-section]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
    el.classList.add('active');
    activeSection = el.dataset.section;
    render();
  });
});
document.querySelectorAll('.chip[data-region]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.chip[data-region]').forEach(x => x.classList.remove('on'));
    el.classList.add('on');
    activeRegion = el.dataset.region;
    render();
  });
});
document.querySelectorAll('.chip[data-sort]').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.chip[data-sort]').forEach(x => x.classList.remove('on'));
    el.classList.add('on');
    activeSort = el.dataset.sort;
    render();
  });
});

// â”€â”€ RSS í”¼ë“œ ëª©ë¡ â”€â”€
// CORS í”„ë¡ì‹œ: allorigins.win (ë¬´ë£Œ, ê´‘ê³  ì—†ìŒ)
const PROXY = 'https://api.allorigins.win/get?url=';

const RSS_FEEDS = [
  // ë¶€ì‚°ì¼ë³´ - ê±´ì„¤/ë¶€ë™ì‚°
  { url: 'https://www.busan.com/rss/S1N15.xml',  source: 'ë¶€ì‚°ì¼ë³´', region: 'ë¶€ì‚°' },
  // êµ­ì œì‹ ë¬¸ - ê²½ì œ
  { url: 'https://www.kookje.co.kr/news2011/rss/section.asp?code=0200', source: 'êµ­ì œì‹ ë¬¸', region: 'ë¶€ì‚°' },
  // ê²½ë‚¨ì‹ ë¬¸
  { url: 'http://www.knnews.co.kr/rss/allArticle.xml', source: 'ê²½ë‚¨ì‹ ë¬¸', region: 'ê²½ë‚¨' },
  // ê²½ë‚¨ë„ë¯¼ì¼ë³´
  { url: 'http://www.idomin.com/rss/allArticle.xml', source: 'ê²½ë‚¨ë„ë¯¼ì¼ë³´', region: 'ê²½ë‚¨' },
  // ìš¸ì‚°ë§¤ì¼
  { url: 'https://www.iusm.co.kr/rss/allArticle.xml', source: 'ìš¸ì‚°ë§¤ì¼', region: 'ìš¸ì‚°' },
  // ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ RSS - ë¶€ì‚° ê±´ì¶•
  { url: 'https://news.naver.com/rss/search/article.naver?query=%EB%B6%80%EC%82%B0+%EA%B1%B4%EC%B6%95', source: 'ë„¤ì´ë²„ë‰´ìŠ¤', region: 'ë¶€ì‚°' },
  // ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰ RSS - ê²½ë‚¨ ê±´ì¶•
  { url: 'https://news.naver.com/rss/search/article.naver?query=%EA%B2%BD%EB%82%A8+%EA%B1%B4%EC%B6%95', source: 'ë„¤ì´ë²„ë‰´ìŠ¤', region: 'ê²½ë‚¨' },
];

// ê±´ì¶• ê´€ë ¨ í‚¤ì›Œë“œ í•„í„°
const ARCH_KEYWORDS = ['ê±´ì¶•','ì°©ê³µ','ì¤€ê³µ','ì„¤ê³„','ê³µëª¨','ë‹¹ì„ ','ì¬ê°œë°œ','ì¬ê±´ì¶•','ë„ì‹œì¬ìƒ','ì‹ ì¶•','ì¸í—ˆê°€','ê±´ì„¤','ë¶„ì–‘','ê°œë°œ','ë„ì‹œê°œë°œ','ì•„íŒŒíŠ¸','ì£¼ê±°','ìƒì—…','ê³µê³µê±´ì¶•','ê±´ë¬¼','ì‹œê³µ','ë¦¬ëª¨ë¸ë§'];
const REGION_KEYWORDS = ['ë¶€ì‚°','ê²½ë‚¨','ìš¸ì‚°','í•´ìš´ëŒ€','ìˆ˜ì˜','ì‚¬í•˜','ë™ë˜','ë‚¨êµ¬','ë¶êµ¬','ì‚¬ìƒ','ê°•ì„œ','ê¸°ì¥','ì°½ì›','ì§„ì£¼','í†µì˜','ê¹€í•´','ë°€ì–‘','ê±°ì œ','ì–‘ì‚°','í•¨ì•ˆ','ê³ ì„±'];

// ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜
function classifyCategory(title, desc) {
  const text = (title + ' ' + desc).toLowerCase();
  if (text.includes('ê³µëª¨') || text.includes('í˜„ìƒì„¤ê³„') || text.includes('ì„¤ê³„ê³µëª¨')) return 'í˜„ìƒì„¤ê³„/ê³µëª¨';
  if (text.includes('ë‹¹ì„ ') || text.includes('ë‹¹ì„ ì‘') || text.includes('ìˆ˜ìƒ')) return 'ë‹¹ì„ ';
  if (text.includes('ì°©ê³µ') || text.includes('ì¸í—ˆê°€') || text.includes('ì°©ìˆ˜') || text.includes('ì‹ ì¶•')) return 'ì°©ê³µ';
  if (text.includes('ì¤€ê³µ') || text.includes('ì™„ê³µ') || text.includes('ê°œê´€') || text.includes('ì¤€ê³µì‹')) return 'ì¤€ê³µ';
  if (text.includes('ì¬ê°œë°œ') || text.includes('ì¬ê±´ì¶•') || text.includes('ë„ì‹œì¬ìƒ') || text.includes('ê°œë°œ') || text.includes('ë¶„ì–‘')) return 'ë„ì‹œê°œë°œ';
  return 'ê¸°íƒ€';
}

function classifyRegion(title, desc, defaultRegion) {
  const text = title + ' ' + desc;
  if (text.includes('ë¶€ì‚°') || text.includes('í•´ìš´ëŒ€') || text.includes('ìˆ˜ì˜') || text.includes('ì‚¬í•˜') || text.includes('ë™ë˜') || text.includes('ê¸°ì¥')) return 'ë¶€ì‚°';
  if (text.includes('ìš¸ì‚°')) return 'ìš¸ì‚°';
  if (text.includes('ê²½ë‚¨') || text.includes('ì°½ì›') || text.includes('ì§„ì£¼') || text.includes('í†µì˜') || text.includes('ê¹€í•´') || text.includes('ê±°ì œ') || text.includes('ì–‘ì‚°')) return 'ê²½ë‚¨';
  return defaultRegion;
}

function extractArea(title, desc) {
  const text = title + ' ' + desc;
  const areaPatterns = ['í•´ìš´ëŒ€êµ¬','ìˆ˜ì˜êµ¬','ì‚¬í•˜êµ¬','ë™ë˜êµ¬','ë‚¨êµ¬','ë¶êµ¬','ì‚¬ìƒêµ¬','ê°•ì„œêµ¬','ê¸°ì¥êµ°','ì—°ì œêµ¬','ë™êµ¬','ì„œêµ¬','ì¤‘êµ¬','ì˜ë„êµ¬','ë¶€ì‚°ì§„êµ¬','ê¸ˆì •êµ¬','ì°½ì›ì‹œ','ì§„ì£¼ì‹œ','í†µì˜ì‹œ','ê¹€í•´ì‹œ','ë°€ì–‘ì‹œ','ê±°ì œì‹œ','ì–‘ì‚°ì‹œ','í•¨ì•ˆêµ°','ê³ ì„±êµ°','ìš¸ì‚° ë‚¨êµ¬','ìš¸ì‚° ë¶êµ¬','ìš¸ì‚° ì¤‘êµ¬','ìš¸ì‚° ë™êµ¬'];
  for (const area of areaPatterns) {
    if (text.includes(area)) return area;
  }
  return '';
}

// RSS XML íŒŒì‹±
function parseRSS(xmlText, feedInfo) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(xmlText, 'text/xml');
  const items = doc.querySelectorAll('item');
  const results = [];

  items.forEach(item => {
    const title = item.querySelector('title')?.textContent?.trim() || '';
    const desc  = item.querySelector('description')?.textContent?.replace(/<[^>]+>/g,'').trim() || '';
    const link  = item.querySelector('link')?.textContent?.trim() || '';
    const pubDate = item.querySelector('pubDate')?.textContent?.trim() || '';

    // ê±´ì¶• ê´€ë ¨ í‚¤ì›Œë“œ í•„í„°ë§
    const text = title + ' ' + desc;
    const hasArch = ARCH_KEYWORDS.some(k => text.includes(k));
    const hasRegion = REGION_KEYWORDS.some(k => text.includes(k));
    if (!hasArch || !hasRegion) return;

    // ë‚ ì§œ íŒŒì‹±
    let dateStr = '';
    try {
      const d = new Date(pubDate);
      if (!isNaN(d)) dateStr = `${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')}`;
    } catch(e) {}

    results.push({
      title,
      desc,
      link,
      dateStr,
      feedInfo,
      timestamp: pubDate ? new Date(pubDate).getTime() : 0,
    });
  });
  return results;
}

// â”€â”€ FETCH & ACCUMULATE (RSS ê¸°ë°˜) â”€â”€
async function loadNews() {
  const btn = document.getElementById('fetchBtn');
  btn.disabled = true;

  const notice = document.createElement('div');
  notice.style.cssText = 'position:fixed;top:0;left:0;right:0;background:var(--ink);color:var(--paper);text-align:center;padding:0.5rem;font-family:"Noto Sans KR",sans-serif;font-size:0.75rem;z-index:300;transition:background 0.3s;';
  document.body.prepend(notice);

  const collectedAt = new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'});

  // íƒ­ë³„ ì¹´í…Œê³ ë¦¬ í•„í„°
  const catFilter = {
    'all': null,
    'ê³µëª¨': 'í˜„ìƒì„¤ê³„/ê³µëª¨',
    'ë‹¹ì„ ': 'ë‹¹ì„ ',
    'ì°©ê³µ': 'ì°©ê³µ',
    'ì¤€ê³µ': 'ì¤€ê³µ',
    'ê°œë°œ': 'ë„ì‹œê°œë°œ',
  };
  const targetCat = catFilter[activeSection] || null;

  try {
    // 1ë‹¨ê³„: RSS ìˆ˜ì§‘
    notice.textContent = `ğŸ“¡ RSS í”¼ë“œ ìˆ˜ì§‘ ì¤‘â€¦ (${RSS_FEEDS.length}ê°œ ì–¸ë¡ ì‚¬)`;
    btn.textContent = 'ìˆ˜ì§‘ ì¤‘â€¦';

    const feedPromises = RSS_FEEDS.map(async feed => {
      try {
        const proxyUrl = PROXY + encodeURIComponent(feed.url);
        const res = await fetch(proxyUrl, { signal: AbortSignal.timeout(8000) });
        if (!res.ok) return [];
        const data = await res.json();
        return parseRSS(data.contents || '', feed);
      } catch(e) {
        return []; // ê°œë³„ í”¼ë“œ ì‹¤íŒ¨ëŠ” ì¡°ìš©íˆ ìŠ¤í‚µ
      }
    });

    const feedResults = await Promise.allSettled(feedPromises);
    let rawItems = feedResults.flatMap(r => r.status === 'fulfilled' ? r.value : []);

    // ìµœì‹ ìˆœ ì •ë ¬, ì¤‘ë³µ ì œê±° (ì œëª© ê¸°ì¤€)
    rawItems.sort((a,b) => b.timestamp - a.timestamp);
    const seenTitles = new Set();
    rawItems = rawItems.filter(item => {
      if (seenTitles.has(item.title)) return false;
      seenTitles.add(item.title);
      return true;
    });

    if (rawItems.length === 0) throw new Error('ìˆ˜ì§‘ëœ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤. RSS í”¼ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');

    notice.textContent = `ğŸ¤– Claude AIê°€ ${rawItems.length}ê°œ ê¸°ì‚¬ ë¶„ë¥˜Â·ìš”ì•½ ì¤‘â€¦`;

    // 2ë‹¨ê³„: Claude APIë¡œ ë¶„ë¥˜/ìš”ì•½ (API í‚¤ í•„ìš”ì‹œ ì•„ë˜ YOUR_API_KEY êµì²´)
    // API í‚¤ ì—†ìœ¼ë©´ ë¡œì»¬ ë¶„ë¥˜ ì‚¬ìš©
    const API_KEY = window.ANTHROPIC_API_KEY || '';

    let newArticles = [];

    if (API_KEY) {
      // Claude APIë¡œ ë¶„ë¥˜ (ë” ì •í™•)
      const itemsForAI = rawItems.slice(0, 20).map((item, i) =>
        `${i+1}. ì œëª©: ${item.title}\n   ì¶œì²˜: ${item.feedInfo.source} (${item.feedInfo.region})\n   ë‚ ì§œ: ${item.dateStr}\n   URL: ${item.link}\n   ë‚´ìš©: ${item.desc.slice(0,100)}`
      ).join('\n\n');

      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': API_KEY,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true',
        },
        body: JSON.stringify({
          model: 'claude-haiku-4-5-20251001', // ê°€ì¥ ì €ë ´í•œ ëª¨ë¸ ì‚¬ìš©
          max_tokens: 3000,
          messages: [{ role: 'user', content: `ë‹¤ìŒ ê¸°ì‚¬ë“¤ì„ ê±´ì¶• ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜í•˜ê³  JSONìœ¼ë¡œ ë°˜í™˜í•˜ì„¸ìš”.
ì¹´í…Œê³ ë¦¬: í˜„ìƒì„¤ê³„/ê³µëª¨ | ë‹¹ì„  | ì°©ê³µ | ì¤€ê³µ | ë„ì‹œê°œë°œ | ê¸°íƒ€
JSONë§Œ ë°˜í™˜, ì½”ë“œë¸”ë¡ ì—†ì´:
{"articles":[{"idx":1,"category":"ì¹´í…Œê³ ë¦¬","area":"ì§€ì—­ëª…","deck":"í•µì‹¬ë‚´ìš©í•œë¬¸ì¥40ìì´ë‚´","importance":3}]}

ê¸°ì‚¬ëª©ë¡:
${itemsForAI}` }]
        })
      });

      if (res.ok) {
        const aiData = await res.json();
        let raw = aiData.content.filter(c=>c.type==='text').map(c=>c.text).join('');
        raw = raw.replace(/```json|```/g,'').trim();
        const s = raw.indexOf('{'), e2 = raw.lastIndexOf('}');
        if (s !== -1 && e2 !== -1) {
          const parsed = JSON.parse(raw.slice(s, e2+1));
          const aiResults = parsed.articles || [];

          newArticles = aiResults.map((ai, i) => {
            const item = rawItems[ai.idx - 1] || rawItems[i];
            if (!item) return null;
            const cat = targetCat ? targetCat : (ai.category || classifyCategory(item.title, item.desc));
            return {
              id: Date.now() + i,
              category: cat,
              region: classifyRegion(item.title, item.desc, item.feedInfo.region),
              area: ai.area || extractArea(item.title, item.desc) || item.feedInfo.region,
              title: item.title,
              deck: ai.deck || item.desc.slice(0, 50),
              body: item.desc.slice(0, 200),
              source: item.feedInfo.source,
              reporter: '',
              date: item.dateStr,
              keywords: [],
              importance: ai.importance || 3,
              url: item.link,
              _collectedAt: collectedAt,
              _isReal: true,
            };
          }).filter(Boolean);
        }
      }
    }

    // API í‚¤ ì—†ê±°ë‚˜ ì‹¤íŒ¨ì‹œ â†’ ë¡œì»¬ ë¶„ë¥˜ (ë¬´ë£Œ)
    if (newArticles.length === 0) {
      notice.textContent = `ğŸ“‹ ë¡œì»¬ ë¶„ë¥˜ ì¤‘â€¦ (API í‚¤ ì—†ìŒ â€” ìë™ í‚¤ì›Œë“œ ë¶„ë¥˜)`;
      newArticles = rawItems.slice(0, 20).map((item, i) => {
        const cat = classifyCategory(item.title, item.desc);
        if (targetCat && cat !== targetCat) return null;
        return {
          id: Date.now() + i,
          category: cat,
          region: classifyRegion(item.title, item.desc, item.feedInfo.region),
          area: extractArea(item.title, item.desc) || item.feedInfo.region,
          title: item.title,
          deck: item.desc.slice(0, 60) + (item.desc.length > 60 ? 'â€¦' : ''),
          body: item.desc.slice(0, 200),
          source: item.feedInfo.source,
          reporter: '',
          date: item.dateStr,
          keywords: ARCH_KEYWORDS.filter(k => (item.title+item.desc).includes(k)).slice(0,3),
          importance: 3,
          url: item.link,
          _collectedAt: collectedAt,
          _isReal: true,
        };
      }).filter(Boolean);
    }

    if (newArticles.length === 0) throw new Error('ê±´ì¶• ê´€ë ¨ ê¸°ì‚¬ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤');

    // ëˆ„ì  ì €ì¥ (ì¤‘ë³µ ì œëª©ì€ ìµœì‹ ìœ¼ë¡œ ë®ì–´ì“°ê¸°)
    const newTitles = new Set(newArticles.map(a => a.title));
    const kept = articles.filter(a => !newTitles.has(a.title));
    articles = [...newArticles, ...kept];

    await saveArticles();
    document.getElementById('updateTime').textContent = 'ë§ˆì§€ë§‰ ìˆ˜ì§‘: ' + collectedAt;
    updateCountBadge();
    updateTicker();
    render();

    notice.style.background = '#2a5a3a';
    notice.textContent = `âœ… ì‹¤ì œ ê¸°ì‚¬ ${newArticles.length}ê°œ ìˆ˜ì§‘ ì™„ë£Œ Â· ì´ ${articles.length}ê±´ ëˆ„ì `;
    setTimeout(() => notice.remove(), 4000);

  } catch(err) {
    notice.style.background = '#8b1a1a';
    notice.textContent = `âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: ${err.message}`;
    setTimeout(() => notice.remove(), 6000);
  }

  btn.disabled = false; btn.textContent = 'â–¶ ë‰´ìŠ¤ ìˆ˜ì§‘';
}

// â”€â”€ HELPERS â”€â”€
function catClass(cat) {
  if (!cat) return 'cat-ê¸°íƒ€';
  if (cat.includes('ê³µëª¨')||cat.includes('í˜„ìƒ')) return 'cat-ê³µëª¨';
  if (cat.includes('ë‹¹ì„ ')) return 'cat-ë‹¹ì„ ';
  if (cat.includes('ì°©ê³µ')) return 'cat-ì°©ê³µ';
  if (cat.includes('ì¤€ê³µ')) return 'cat-ì¤€ê³µ';
  if (cat.includes('ê°œë°œ')) return 'cat-ê°œë°œ';
  return 'cat-ê¸°íƒ€';
}

function filtered() {
  let list = [...articles];
  if (activeSection !== 'all') list = list.filter(a => a.category && a.category.includes(activeSection));
  if (activeRegion !== 'ì „ì²´') list = list.filter(a => a.region === activeRegion);
  list.sort((a,b) => activeSort === 'importance'
    ? (b.importance||1)-(a.importance||1)
    : (b.id||0)-(a.id||0));  // idê°€ í´ìˆ˜ë¡ ìµœì‹  (Date.now ê¸°ë°˜)
  return list;
}

function updateTicker() {
  const top = [...articles].sort((a,b)=>(b.importance||1)-(a.importance||1)).slice(0,6);
  if (!top.length) return;
  document.getElementById('tickerText').textContent =
    top.map(a=>`â–¶ [${a.area||a.region}] ${a.title}`).join('   Â·   ') + '   ';
}

// â”€â”€ FACT CHECK â”€â”€
const FC_STORAGE_KEY = 'arch-busan-verified'; // ê²€ì¦ ì™„ë£Œëœ id ëª©ë¡
let verifiedIds = new Set();    // ê²€ì¦ ì™„ë£Œ id
let removedCount = 0;

async function loadVerified() {
  try {
    const r = await window.storage.get(FC_STORAGE_KEY);
    if (r && r.value) {
      const data = JSON.parse(r.value);
      verifiedIds = new Set(data.ids || []);
      removedCount = data.removedCount || 0;
    }
  } catch(e) {}
  updateFcStats();
}

async function saveVerified() {
  try {
    await window.storage.set(FC_STORAGE_KEY, JSON.stringify({
      ids: [...verifiedIds],
      removedCount
    }));
  } catch(e) {}
}

function updateFcStats() {
  const pending = articles.filter(a => !verifiedIds.has(String(a.id))).length;
  const verified = articles.filter(a => verifiedIds.has(String(a.id))).length;
  const pEl = document.getElementById('fcStatPending');
  const vEl = document.getElementById('fcStatVerified');
  const rEl = document.getElementById('fcStatRemoved');
  if (pEl) pEl.innerHTML = `ë¯¸ê²€í†  <strong>${pending}</strong>`;
  if (vEl) vEl.innerHTML = `ê²€ì¦ì™„ë£Œ <strong>${verified}</strong>`;
  if (rEl) rEl.innerHTML = `ì‚­ì œë¨ <strong>${removedCount}</strong>`;

  const btn = document.getElementById('fcBtn');
  if (btn) {
    if (pending === 0 && articles.length > 0) {
      btn.textContent = 'âœ“ ëª¨ë‘ ê²€í† ë¨';
      btn.disabled = true;
    } else {
      btn.textContent = pending > 0 ? `ê²€í†  ì‹œì‘ (${pending}ê±´)` : 'ê²€í†  ì‹œì‘';
      btn.disabled = false;
    }
  }
}

async function runFactCheck() {
  const unverified = articles.filter(a => !verifiedIds.has(String(a.id)));
  if (!unverified.length) {
    alert('ëª¨ë“  ê¸°ì‚¬ê°€ ì´ë¯¸ ê²€í† ë˜ì—ˆìŠµë‹ˆë‹¤.');
    return;
  }

  const btn = document.getElementById('fcBtn');
  const desc = document.getElementById('fcDesc');
  btn.disabled = true;

  // ë°°ì¹˜ ë‹¨ìœ„ë¡œ ì²˜ë¦¬ (10ê°œì”©)
  const BATCH = 10;
  let deletedTitles = [];
  let totalChecked = 0;

  for (let i = 0; i < unverified.length; i += BATCH) {
    const batch = unverified.slice(i, i + BATCH);
    const remaining = unverified.length - i;
    btn.textContent = `ê²€í†  ì¤‘â€¦ (${Math.min(i + BATCH, unverified.length)}/${unverified.length})`;
    desc.textContent = `AIê°€ ${batch.length}ê°œ ê¸°ì‚¬ ê²€ì¦ ì¤‘â€¦ (ë‚¨ì€ ë¯¸ê²€í† : ${remaining}ê±´)`;

    const batchList = batch.map((a, idx) =>
      `${idx + 1}. [id:${a.id}] "${a.title}" / ì¶œì²˜: ${a.source||'ë¶ˆëª…'} / ë‚ ì§œ: ${a.date||'ë¶ˆëª…'} / ${a._isReal ? 'ì›¹ê²€ìƒ‰ìˆ˜ì§‘' : 'AIìƒì„±'}`
    ).join('\n');

    try {
      const res = await fetch("https://api.anthropic.com/v1/messages", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          model: "claude-sonnet-4-20250514",
          max_tokens: 1500,
          system: `ë‹¹ì‹ ì€ íŒ©íŠ¸ì²´í¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì œê³µëœ ê¸°ì‚¬ ëª©ë¡ì„ ê²€í† í•˜ê³  ê° ê¸°ì‚¬ì— ëŒ€í•´ íŒì •ì„ ë‚´ë ¤ì£¼ì„¸ìš”.
ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ë§Œ ë°˜í™˜í•˜ì„¸ìš”.

{"results":[{"id":"ê¸°ì‚¬id","verdict":"real|fake|uncertain","reason":"íŒì •ì´ìœ  20ì ì´ë‚´"}]}

íŒì • ê¸°ì¤€:
- real: ì‹¤ì œ ë‰´ìŠ¤ë¡œ ë³´ì´ëŠ” ê¸°ì‚¬ (ì›¹ê²€ìƒ‰ ìˆ˜ì§‘, ì‹¤ì œ ì–¸ë¡ ì‚¬, êµ¬ì²´ì  ì •ë³´)
- fake: AIê°€ ìƒì„±í•œ ê°€ìƒ ê¸°ì‚¬ì´ê±°ë‚˜ ëª…ë°±íˆ í—ˆìœ„ì¸ ê¸°ì‚¬
- uncertain: íŒë‹¨í•˜ê¸° ì–´ë ¤ìš´ ê¸°ì‚¬ (uncertainì€ ì‚­ì œí•˜ì§€ ì•ŠìŒ)

_isReal=false ì´ê±°ë‚˜ ì¶œì²˜ê°€ ë¶ˆëª…í™•í•˜ë©´ fake ê°€ëŠ¥ì„± ë†’ìŒ
ê¸°ì‚¬ ë‚´ìš©ì´ ì§€ë‚˜ì¹˜ê²Œ êµ¬ì²´ì ì´ì§€ë§Œ ì¶œì²˜ê°€ ì—†ìœ¼ë©´ fake ê°€ëŠ¥ì„± ë†’ìŒ`,
          messages: [{ role: "user", content: `ë‹¤ìŒ ê¸°ì‚¬ë“¤ì„ ê²€í† í•´ì£¼ì„¸ìš”:\n\n${batchList}\n\nJSONë§Œ ë°˜í™˜í•˜ì„¸ìš”.` }]
        })
      });

      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      let raw = data.content.filter(c=>c.type==='text').map(c=>c.text).join('');
      raw = raw.replace(/```json|```/g,'').trim();
      const s = raw.indexOf('{'), e2 = raw.lastIndexOf('}');
      if (s !== -1 && e2 !== -1) {
        const parsed = JSON.parse(raw.slice(s, e2+1));
        const results = parsed.results || [];

        // íŒì • ì²˜ë¦¬
        const fakeIds = results.filter(r => r.verdict === 'fake').map(r => String(r.id));
        const passIds = results.filter(r => r.verdict !== 'fake').map(r => String(r.id));

        // ê°€ì§œ ê¸°ì‚¬ ì‚­ì œ
        if (fakeIds.length) {
          const fakeArticles = articles.filter(a => fakeIds.includes(String(a.id)));
          deletedTitles.push(...fakeArticles.map(a => a.title));
          articles = articles.filter(a => !fakeIds.includes(String(a.id)));
          removedCount += fakeIds.length;
        }

        // ê²€ì¦ ì™„ë£Œ í‘œì‹œ (ì‚­ì œëœ ê²ƒ í¬í•¨ â€” ë‹¤ìŒì— ì¬ê²€í†  ë¶ˆí•„ìš”)
        [...fakeIds, ...passIds].forEach(id => verifiedIds.add(id));
        // ë°°ì¹˜ ì™„ë£Œë§ˆë‹¤ ì €ì¥
        await saveArticles();
        await saveVerified();
        totalChecked += batch.length;
        updateFcStats();
        render();
      }
    } catch(e) {
      console.warn('ë°°ì¹˜ ê²€í†  ì‹¤íŒ¨:', e);
      // ì‹¤íŒ¨í•œ ë°°ì¹˜ëŠ” ê±´ë„ˆë›°ê³  ê³„ì†
    }
  }

  // ì™„ë£Œ ë³´ê³ 
  const summary = deletedTitles.length > 0
    ? `ğŸ—‘ ${deletedTitles.length}ê°œ ê°€ì§œ/AIìƒì„± ê¸°ì‚¬ ì‚­ì œë¨:\n${deletedTitles.slice(0,5).map(t=>'â€¢ '+t).join('\n')}${deletedTitles.length > 5 ? `\nì™¸ ${deletedTitles.length-5}ê°œ` : ''}`
    : `âœ… ${totalChecked}ê°œ ê¸°ì‚¬ ê²€í†  ì™„ë£Œ â€” ê°€ì§œ ê¸°ì‚¬ ì—†ìŒ`;
  alert(summary);

  desc.textContent = `ë§ˆì§€ë§‰ ê²€í† : ${new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'})} Â· ${totalChecked}ê±´ ê²€í† , ${deletedTitles.length}ê±´ ì‚­ì œ`;
  btn.textContent = 'ê²€í†  ì™„ë£Œ';
  updateFcStats();
}

// â”€â”€ DELETE â”€â”€
async function deleteArticle(id, e) {
  e.stopPropagation(); // ì¹´ë“œ í´ë¦­(ëª¨ë‹¬ ì—´ê¸°) ë°©ì§€
  articles = articles.filter(a => a.id != id);
  await saveArticles();
  updateCountBadge();
  updateTicker();
  render();
  // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
  document.getElementById('backdrop').classList.remove('open');
}

// â”€â”€ RENDER â”€â”€
function render() {
  const list = filtered();
  if (!list.length) {
    document.getElementById('frontPage').innerHTML = `<div class="loading-full"><div class="loading-msg" style="font-style:normal;">í•´ë‹¹ ì¡°ê±´ì˜ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤</div></div>`;
    document.getElementById('lowerGrid').style.display = 'none';
    return;
  }

  const hero = list[0];
  const sideItems = list.slice(1, 7);
  const lower = list.slice(7);

  // ìˆ˜ì§‘ íšŒì°¨ í‘œì‹œ (ëª‡ ë²ˆ ìˆ˜ì§‘í–ˆëŠ”ì§€)
  const batches = [...new Set(articles.map(a=>a._collectedAt).filter(Boolean))];

  const heroHtml = `
  <article class="story-hero" style="position:relative;" onclick="openModal(${hero.id})">
    <button class="delete-btn" onclick="deleteArticle(${hero.id}, event)" title="ê¸°ì‚¬ ì‚­ì œ">âœ• ì‚­ì œ</button>
    <div class="kicker-row">
      <span class="cat-badge ${catClass(hero.category)}">${hero.category||'ê¸°íƒ€'}</span>
      <span class="area-tag">${hero.area||hero.region||''}</span>
      ${hero._collectedAt ? `<span class="area-tag" style="color:var(--muted);">ìˆ˜ì§‘ ${hero._collectedAt}</span>` : ''}
    </div>
    <h1>${hero.title}</h1>
    <p class="deck">${hero.deck||''}</p>
    <div class="body-text"><p>${hero.body||''}</p></div>
    <div class="byline">
      <span class="src">${hero.source||''}</span>
      <span>${hero.reporter||''}</span>
      <span>${hero.date||''}</span>
      ${(hero.keywords||[]).slice(0,3).map(k=>`<span>#${k}</span>`).join('')}
    </div>
  </article>`;

  const statsRows = [
    ['í˜„ìƒì„¤ê³„/ê³µëª¨', articles.filter(a=>a.category?.includes('ê³µëª¨')||a.category?.includes('í˜„ìƒ')).length],
    ['ë‹¹ì„ ', articles.filter(a=>a.category?.includes('ë‹¹ì„ ')).length],
    ['ì°©ê³µÂ·ì¸í—ˆê°€', articles.filter(a=>a.category?.includes('ì°©ê³µ')).length],
    ['ì¤€ê³µÂ·ì™„ê³µ', articles.filter(a=>a.category?.includes('ì¤€ê³µ')).length],
    ['ë„ì‹œê°œë°œ', articles.filter(a=>a.category?.includes('ê°œë°œ')).length],
    ['ëˆ„ì  ì´ ê¸°ì‚¬', articles.length],
  ].map(([l,v])=>`<div class="stats-row"><span>${l}</span><span class="stats-num">${v}</span></div>`).join('');

  const sidebarHtml = `
  <aside class="sidebar-col">
    <div class="sidebar-section">
      <div class="section-head red">ì£¼ìš” ê¸°ì‚¬</div>
      ${sideItems.map(a=>`
        <div class="story-sm" onclick="openModal(${a.id})">
          <button class="delete-btn" onclick="deleteArticle(${a.id}, event)" title="ê¸°ì‚¬ ì‚­ì œ">âœ•</button>
          <span class="cat-badge ${catClass(a.category)}">${a.category||'ê¸°íƒ€'}</span>
          <span class="area-tag" style="margin-left:0.3rem;">${a.area||a.region||''}</span>
          <h3>${a.title}</h3>
          <p>${a.deck||''}</p>
          <div class="smeta"><span class="ssrc">${a.source||''}</span>&nbsp; ${a.date||''}</div>
        </div>`).join('')}
    </div>
    <div class="sidebar-section">
      <div class="section-head">ëˆ„ì  í†µê³„</div>
      <div class="stats-box">
        <div class="stats-title">ACCUMULATED Â· ìˆ˜ì§‘ ${batches.length}íšŒ</div>
        ${statsRows}
      </div>
    </div>
    <div class="sidebar-section">
      <div class="section-head">ê´€ë¦¬</div>
      <button onclick="clearAll()" style="width:100%;padding:0.4rem;background:transparent;border:1px solid var(--rule-light);font-family:'Noto Sans KR',sans-serif;font-size:0.68rem;color:var(--muted);cursor:pointer;margin-top:0.25rem;">
        ğŸ—‘ ì „ì²´ ê¸°ì‚¬ ì´ˆê¸°í™”
      </button>
    </div>
  </aside>`;

  document.getElementById('frontPage').innerHTML = heroHtml + sidebarHtml;
  updateFcStats();

  // LOWER GRID
  if (lower.length) {
    const cols = [
      { title: 'í˜„ìƒì„¤ê³„ Â· ê³µëª¨ Â· ë‹¹ì„ ', fn: a => a.category?.includes('ê³µëª¨')||a.category?.includes('í˜„ìƒ')||a.category?.includes('ë‹¹ì„ ') },
      { title: 'ì°©ê³µ Â· ì¸í—ˆê°€', fn: a => a.category?.includes('ì°©ê³µ') },
      { title: 'ì¤€ê³µ Â· ì™„ê³µ', fn: a => a.category?.includes('ì¤€ê³µ') },
      { title: 'ë„ì‹œê°œë°œ ì´ìŠˆ', fn: a => a.category?.includes('ê°œë°œ')||a.category?.includes('ê¸°íƒ€') },
    ];
    const used = new Set();
    const colData = cols.map(c => {
      const items = lower.filter(a => !used.has(a.id) && c.fn(a));
      items.forEach(a => used.add(a.id));
      return { ...c, items };
    });
    lower.filter(a => !used.has(a.id)).forEach(a => colData[3].items.push(a));

    document.getElementById('lowerGrid').style.display = 'grid';
    document.getElementById('lowerGrid').innerHTML = colData.map(c => `
      <div class="lower-col">
        <div class="col-title">â–  ${c.title}</div>
        ${c.items.length ? c.items.map(a=>`
          <div class="story-sm" onclick="openModal(${a.id})">
            <button class="delete-btn" onclick="deleteArticle(${a.id}, event)" title="ê¸°ì‚¬ ì‚­ì œ">âœ•</button>
            <span class="cat-badge ${catClass(a.category)}">${a.area||a.region||''}</span>
            <h3>${a.title}</h3>
            <p>${a.deck||''}</p>
            <div class="smeta"><span class="ssrc">${a.source||''}</span>&nbsp; ${a.date||''} ${a._collectedAt?'Â· '+a._collectedAt+' ìˆ˜ì§‘':''}</div>
          </div>`).join('')
        : `<p style="font-size:0.7rem;color:var(--rule-light);padding:0.5rem 0;">í•´ë‹¹ ê¸°ì‚¬ ì—†ìŒ</p>`}
      </div>`).join('');
  } else {
    document.getElementById('lowerGrid').style.display = 'none';
  }
}

// â”€â”€ MODAL â”€â”€
function openModal(id) {
  const a = articles.find(x => x.id == id);
  if (!a) return;
  document.getElementById('mKicker').innerHTML = `<span class="cat-badge ${catClass(a.category)}">${a.category||'ê¸°íƒ€'}</span><span style="color:var(--muted);margin-left:0.4rem;">${a.area||a.region||''}</span>`;
  document.getElementById('mTitle').textContent = a.title;
  document.getElementById('mDeck').textContent = a.deck||'';
  document.getElementById('mByline').innerHTML = `<span class="msrc">${a.source||''}</span><span>${a.reporter||''}</span><span>${a.date||''}</span>${a._collectedAt?`<span>ìˆ˜ì§‘: ${a._collectedAt}</span>`:''}`;
  document.getElementById('mBody').textContent = a.body||'';
  document.getElementById('mKeywords').innerHTML = (a.keywords||[]).map(k=>`<span class="kw-pill">#${k}</span>`).join('');

  // ì›ë¬¸ ê²€ìƒ‰ ë§í¬ ìƒì„±
  const q = encodeURIComponent(a.title);
  const qFull = encodeURIComponent(a.title + ' ' + (a.area||a.region||'ë¶€ì‚°'));
  const naverNews  = `https://search.naver.com/search.naver?where=news&query=${qFull}`;
  const googleNews = `https://www.google.com/search?q=${qFull}&tbm=nws`;

  const realUrlBtn = a.url
    ? `<a class="search-link primary" href="${a.url}" target="_blank" rel="noopener">ğŸ“„ ì›ë¬¸ ë°”ë¡œê°€ê¸°</a>`
    : '';
  const isRealBadge = a._isReal
    ? `<span style="font-size:0.6rem;background:#d4eada;color:#1a4a2e;padding:0.1rem 0.4rem;border:1px solid #a0c8a8;">âœ“ ì‹¤ì œ ê¸°ì‚¬</span>`
    : `<span style="font-size:0.6rem;background:#f7e9c8;color:#5a3800;padding:0.1rem 0.4rem;border:1px solid #d4b86a;">AI ìƒì„±</span>`;

  document.getElementById('mLinks').innerHTML = `
    <div style="width:100%;display:flex;align-items:center;gap:0.5rem;margin-bottom:0.4rem;">
      ${isRealBadge}
      <span style="font-size:0.62rem;color:var(--muted);">ì›ë¬¸ í™•ì¸</span>
    </div>
    ${realUrlBtn}
    <a class="search-link ${!a.url ? 'primary' : ''}" href="${naverNews}" target="_blank" rel="noopener">ğŸ” ë„¤ì´ë²„ ë‰´ìŠ¤ ê²€ìƒ‰</a>
    <a class="search-link" href="${googleNews}" target="_blank" rel="noopener">ğŸŒ êµ¬ê¸€ ë‰´ìŠ¤ ê²€ìƒ‰</a>
    ${!a._isReal ? `<span class="search-link-note">â€» AIê°€ ìƒì„±í•œ ìš”ì•½ ê¸°ì‚¬ì…ë‹ˆë‹¤. ì›ë¬¸ í™•ì¸ì„ ìœ„í•´ ìœ„ ë§í¬ë¡œ ê²€ìƒ‰í•´ ë³´ì„¸ìš”.</span>` : ''}
  `;

  document.getElementById('mDeleteBtn').onclick = (e) => deleteArticle(a.id, e);
  document.getElementById('backdrop').classList.add('open');
  document.getElementById('backdrop').scrollTop = 0;
}
function closeModal(e) {
  if (e.target === document.getElementById('backdrop'))
    document.getElementById('backdrop').classList.remove('open');
}

// â”€â”€ INIT â”€â”€
loadSaved();
loadVerified();
</script>
</body>
</html>
